#!/bin/bash

ROOTDIR=$(git rev-parse --show-toplevel 2> /dev/null)
if [ -d "$ROOTDIR" ]; then
    OLDDIR=$PWD
    cd $ROOTDIR

    if [ -d build ]; then
        cd build
    fi

    if [ -f Makefile ]; then
        make $1 && ls -1 *.deb | perl -ne 'chomp and /^(.*?)_/; `cp $_ ~/$1.deb`;' && make clean

    elif [ -f build ] || [ -f build.xml ]; then
        ant $1 && ls -1 *.deb | perl -ne 'chomp and /^(.*?)_/; `cp $_ ~/$1.deb`;'
        ls -1 bin/*.deb | perl -ne 'chomp and /^(?:bin\/)(.*?)_/; `cp $_ ~/$1.deb`;' && ant clean 

    else
        echo "***** No make/build files found."
    fi

    cd $OLDDIR
else
    echo "***** No make/build files found."
fi

